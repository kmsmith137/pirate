# Add Kernel Registration Boilerplate

Use this prompt when you need to add registry support for a new GPU kernel class.

## Context

This project uses a KernelRegistry pattern to register procedurally generated CUDA kernels at library initialization time. This involves:

1. **C++ side** (`PeakFindingKernel.hpp/cu`): Define `RegistryKey`, `RegistryValue`, and registry boilerplate
2. **Python side** (`cuda_generator/*.py`): Emit C++ registration code in the generated `.cu` files

## Prompt Template

```
I need to add kernel registration for [ClassName].

Reference files:
- Header with RegistryKey/RegistryValue: include/pirate/[Header].hpp
- Registry implementation: src_lib/[Implementation].cu  
- Python code generator: pirate_frb/cuda_generator/[Generator].py
- Example generated kernel: src_lib/autogenerated_kernels/[example].cu

The registry has been defined in the header, but the Python code generator
doesn't emit the registration boilerplate yet.

Please:
1. Look at an existing example (e.g., TestPfWeightReader or GpuPeakFindingKernel)
   to understand the pattern
2. Add a method to emit the registration boilerplate in the Python generator
3. Include the necessary C++ headers (e.g., inlines.hpp for vec_equal())
4. Verify the generated code compiles
```

## Checklist

- [ ] RegistryKey and RegistryValue structs defined in .hpp
- [ ] `using Registry = KernelRegistry<...>` typedef
- [ ] `static Registry &registry()` member function
- [ ] `operator==` and `operator<<` for key/value in .cu
- [ ] Python `_emit_registration_boilerplate()` method
- [ ] Include `inlines.hpp` if using `vec_equal()` for FrequencySubbands checks
- [ ] Generated kernel compiles successfully

## Example Files

- Pattern reference: `pf_weight_reader_test_*.cu` (has registration boilerplate)
- Python generator: `PeakFinder2.py` â†’ `PfWeightReader.emit_test_kernel()`

